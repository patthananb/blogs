<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post - My Blog</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>
    <header>
        <nav class="container">
            <a href="index.html" class="logo">My Blog</a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="about.html">About</a></li>
            </ul>
            <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
                <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </button>
        </nav>
    </header>

    <main class="container">
        <article class="post-content">
            <div class="post-header">
                <a href="index.html" class="back-link">&larr; Back to posts</a>
                <h1 id="post-title"></h1>
                <div class="post-meta">
                    <span id="post-date"></span>
                    <span id="post-author"></span>
                </div>
            </div>
            <div id="content" class="markdown-body">
                <!-- Markdown content will be rendered here -->
            </div>
        </article>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2026 My Blog. All rights reserved.</p>
        </div>
    </footer>

    <script src="js/posts.js"></script>
    <script src="js/theme.js"></script>
    <script>
        // Configure marked with highlight.js
        marked.setOptions({
            highlight: function(code, lang) {
                if (lang && hljs.getLanguage(lang)) {
                    return hljs.highlight(code, { language: lang }).value;
                }
                return hljs.highlightAuto(code).value;
            },
            breaks: true,
            gfm: true
        });

        // Get post slug from URL
        const urlParams = new URLSearchParams(window.location.search);
        const slug = urlParams.get('slug');

        if (slug) {
            // Find the post
            const post = posts.find(p => p.slug === slug);
            
            if (post) {
                document.title = `${post.title} - My Blog`;
                document.getElementById('post-title').textContent = post.title;
                document.getElementById('post-date').textContent = post.date;
                document.getElementById('post-author').textContent = `by ${post.author}`;
                
                // Fetch and render the markdown file
                fetch(`posts/${slug}.md`)
                    .then(response => {
                        if (!response.ok) throw new Error('Post not found');
                        return response.text();
                    })
                    .then(markdown => {
                        document.getElementById('content').innerHTML = marked.parse(markdown);
                        // Apply syntax highlighting to code blocks
                        document.querySelectorAll('pre code').forEach((block) => {
                            hljs.highlightElement(block);
                        });
                    })
                    .catch(error => {
                        document.getElementById('content').innerHTML = '<p>Sorry, this post could not be loaded.</p>';
                    });
            } else {
                document.getElementById('content').innerHTML = '<p>Post not found.</p>';
            }
        } else {
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
